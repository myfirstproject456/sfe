<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<%- include lib/apicalh01 %>
<% var pagename="Dashboard" %>
	<!-- ================== BEGIN PAGE LEVEL CSS STYLE ================== -->
		<link href="assets/plugins/bootstrap-select/bootstrap-select.min.css" rel="stylesheet" />
	<link href="assets/plugins/select2/dist/css/select2.min.css" rel="stylesheet" />
	<link href="assets/plugins/jquery-jvectormap/jquery-jvectormap.css" rel="stylesheet" />
	<link href="assets/plugins/bootstrap-calendar/css/bootstrap_calendar.css" rel="stylesheet" />
	<link href="assets/plugins/gritter/css/jquery.gritter.css" rel="stylesheet" />
	<link href="assets/plugins/morris/morris.css" rel="stylesheet" />
	    <link href="assets/plugins/gritter/css/jquery.gritter.css" rel="stylesheet" />	
	<!-- ================== END PAGE LEVEL CSS STYLE ================== -->
	
	<!-- ================== BEGIN BASE JS ================== -->


	<link href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/themes/blitzer/jquery-ui.css"
	rel="stylesheet" type="text/css" />
    <link href="assets/plugins/parsley/src/parsley.css" rel="stylesheet" />
	<!-- ================== END BASE JS ================== -->
	<style type="text/css">
	h3{color: white !important}
	#btnShow
	{
		width: 40px;
		height: 40px;
	}
	.service-request {
                float:right;
                height: 50px;
                text-align: center;
                font-weight: bold;
            }
	input,textarea,select{
		margin:0 0 10px 0;
	}

	.gritter-center{
		position:fixed;
		left:33%;
		right:33%;
		top:33%,
		width:301px,
 		height:301px,
}
</style>
<body>
 <!-- begin #page-loader -->
    <div id="page-loader" class="fade in"><span class="spinner"></span></div>
    <!-- end #page-loader -->
    
    <!-- begin #page-container -->
    <div id="page-container" class="fade page-sidebar-fixed page-header-fixed">
        <%- include lib/apicalh02 %>
        <!-- begin #sidebar -->
        <div id="sidebar" class="sidebar">
            <!-- begin sidebar scrollbar -->
            <div data-scrollbar="true" data-height="100%">
                <!-- begin sidebar user -->
                <ul class="nav">
                    <li class="nav-profile">
                        <div class="image">
                            <a href="javascript:;"><img src="assets/img/user.png" alt="" /></a>
                        </div>
                        <div class="info">
                            <%=user.enname  %>
                        </div>
                    </li>
                </ul>
                <!-- end sidebar user -->
                <%- include lib/apicalm01 %>
            </div>
            <!-- end sidebar scrollbar -->
        </div>
        <!-- end #sidebar -->
    		<!-- begin #content -->
		<div id="content" class="content">
			<!-- begin breadcrumb -->
			<div class="service-request">Service Request: 
                        	<a href="#modal-dialog" class="btn btn-success btn-icon btn-circle" data-toggle="modal" id="btnShow">
                            <i class="fa fa-plus fa-1x" style="margin-top: 12px;" ></i></a>
                        </div>
			<!-- end breadcrumb -->
			<!-- begin page-header -->
			<h1 class="page-header">Dashboard<small></small></h1>
			<!-- end page-header -->
			<!-- begin row -->
			<div class="row">
				<!-- begin col-3 -->
				<div class="col-md-4 col-sm-6" onclick="location.href='/equipmentlist'">
					<div class="widget widget-stats bg-green">
						<div class="stats-icon stats-icon-lg"><i class="fa fa-cube fa-fw"></i></div>
						<div class="stats-title">MY EQUIPMENTS</div>
						<div class="stats-number"><%= kpis[0].equi_count %></div>
						<div class="stats-desc"></div>
					</div>
				</div>
				
				<!-- end col-3 -->
				<!-- begin col-3 -->
				<div class="col-md-4 col-sm-6" onclick="location.href='/custservicelist'">
					<div class="widget widget-stats bg-blue">
						<div class="stats-icon stats-icon-lg"><i class="fa fa-ticket fa-fw"></i></div>
						<div class="stats-title">SERVICE CALLS</div>
						<div class="stats-number"><%= kpis[0].serv_count %></div>
						<div class="stats-desc"></div>
					</div>
				</div>
				<!-- end col-3 -->
				<!-- begin col-3 -->
				<div class="col-md-4 col-sm-6" onclick="location.href='/help'">
					<div class="widget widget-stats bg-purple">
						<div class="stats-icon stats-icon-lg"><i class="fa fa-question fa-fw"></i></div>
						<div class="stats-title">HELP</div>
						<div class="stats-number">4</div>
						<div class="stats-desc"></div>
					</div>
				</div>
				<!-- end col-3 -->
				<!-- begin col-3 -->

				<!-- end col-3 -->
			</div>
			<!-- end row -->
			
			<!-- begin row -->
			<div class="row">

				<!--  <h2>Carousel Example</h2> -->
				<div id="myCarousel" class="carousel slide" data-ride="carousel">
					<!-- Indicators -->
					<ol class="carousel-indicators">
						<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
						<li data-target="#myCarousel" data-slide-to="1"></li>
						<li data-target="#myCarousel" data-slide-to="2"></li>
						<li data-target="#myCarousel" data-slide-to="3"></li>
						<li data-target="#myCarousel" data-slide-to="4"></li>
						<li data-target="#myCarousel" data-slide-to="5"></li>
						<li data-target="#myCarousel" data-slide-to="6"></li>

					</ol>

					<!-- Wrapper for slides -->
					<div class="carousel-inner">

						<div class="item active" >
							<img src="assets/img/electric_motors.png" alt="Los Angeles" style="width:100%;">
							<div class="carousel-caption">
								<h3 style="color:blue;">Site Map</h3>
								<!-- <p>LA is always so much fun!</p> -->
							</div>
						</div>

						<div class="item">
							<img src="assets/img/gear_motors.png" alt="Chicago" style="width:100%;">
							<div class="carousel-caption" >
								<h3 style="color: black;">Electric Motors</h3>
								<!--  <p>Thank you, Chicago!</p> -->
							</div>
						</div>

						<div class="item">
							<img src="assets/img/geared_motors.png" alt="New York" style="width:100%;">
							<div class="carousel-caption">
								<h3>Inline Helical Gear Motors</h3>
								<!--  <p>We love the Big Apple!</p> -->
							</div>
						</div>
						<div class="item">
							<img src="assets/img/three_phase_motors.png" alt="New York" style="width:100%;">
							<div class="carousel-caption">
								<h3>Inline Helical Gear Motors</h3>
								<!--  <p>We love the Big Apple!</p> -->
							</div>
						</div>

					</div>

					<!-- Left and right controls -->
					<a class="left carousel-control" href="#myCarousel" data-slide="prev">
						<span class="glyphicon glyphicon-chevron-left"></span>
						<span class="sr-only">Previous</span>
					</a>
					<a class="right carousel-control" href="#myCarousel" data-slide="next">
						<span class="glyphicon glyphicon-chevron-right"></span>
						<span class="sr-only">Next</span>
					</a>
				</div>



			</div>

			<div class="modal fade" id="modal-dialog">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
							<h4 class="modal-title">Service Request</h4>
						</div>
						<div class="modal-body">
							<div class="row">
							
									<form id="frmUploader" enctype="multipart/form-data" action="/save_request" method="post"  data-parsley-validate="true">
										<div class="form-group">

											<label class="control-label col-md-3">Product Brand</label>
											<div class="col-md-9">
												<select class="form-control selectpicker col-md-8" data-size="10"   data-live-search="true" data-style="btn-white" name="prod_brid" api="v1/getproductbrand" required="">
													<option value="NA" selected>NA</option>												
												</select>
												<div id="divproductbrand" hidden="true">
													<input type="text" name="brandname" placeholder="Product Brand" class="form-control " value="" hidden="true" />
												</div>
											</div>
											
											<label class="control-label col-md-3">Product Category</label>
											<div class="col-md-9">
												<select class="form-control selectpicker col-md-8" data-size="10"   data-live-search="true" data-style="btn-white" name="product" api="v1/getproductscat" required="">
													<option value="NA" selected>NA</option>
												</select>
												<div id="divproductcatip" hidden="true">
													<input type="text" name="prodcatname" placeholder="Product Category" class="form-control " value="" hidden="true" />
												</div>
											</div>

                                            <label class="col-md-3">Machine Name </label>
											<div class="col-md-9">
												  <input type="text" name="machinename" placeholder="Machine Name" class="form-control" value="" />
											</div>

											<label class="col-md-3">Product Model No </label>
											<div class="col-md-9">
												<input type="text" name="modelno" placeholder="Model No" class="form-control" value=""/>
											</div>

											<label class="col-md-3">Product Serial No </label>
											<div class="col-md-9">
												<input type="text" name="serialno" placeholder="Serial No" class="form-control" value="" />
											</div>

											<label class="col-md-3">Issue Description </label>
											<div class="col-md-9">
												 <textarea class="form-control" placeholder="Description" rows="2" name="description" ></textarea>
											</div>

											<label class="col-md-3">Batch Date </label>
											<div class="col-md-9">
												<input type="text" name="batchdate" placeholder="Batch Date" class="form-control datepicker" value="" />
											</div>	
											<div id="empty_div" style="height:10px" class="col-md-12 ">
                                            <label class="col-md-4 "></label>
                                            </div>
											<label class="col-md-3">Images </label>
											<div class="col-md-9">
												<input type="file" name="imgUploader" id="image" accept="image/*,.pdf,.csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" multiple />
												<p><small>(Maximum 5 images)</small></p>
											</div>
										</div>
									</form>
								</div>   
							</div>
							<div class="modal-footer">
								<a href="javascript:;" class="btn btn-sm btn-white" data-dismiss="modal">Close</a>
								<a href="javascript:onSubmit();" class="btn btn-sm btn-success" >Done</a>

							</div>
						</div>
					</div>
				</div>
				<!-- end row -->


			</div>

			<!-- end #content -->
			<!-- begin scroll to top btn -->
			<!-- <a href="javascript:;" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top"><i class="fa fa-angle-up"></i></a> -->
			<!-- end scroll to top btn -->
		</div>

		<!-- end page container -->

                    <!-- ================== BEGIN BASE JS ================== -->
                    <%- include lib/apicalf02.ejs %>	
                    <!-- ================== END BASE JS ================== -->

		<!-- ================== BEGIN PAGE LEVEL JS ================== -->
		<script src="assets/plugins/bootstrap-select/bootstrap-select.min.js"></script>
		<script src="assets/plugins/select2/dist/js/select2.min.js"></script>
		<script src="assets/plugins/morris/raphael.min.js"></script>
		<script src="assets/plugins/morris/morris.js"></script>
		<script src="assets/plugins/jquery-jvectormap/jquery-jvectormap.min.js"></script>
		<script src="assets/plugins/jquery-jvectormap/jquery-jvectormap-world-merc-en.js"></script>
		<script src="assets/plugins/bootstrap-calendar/js/bootstrap_calendar.min.js"></script>
		<script src="assets/plugins/gritter/js/jquery.gritter.js"></script>
		<script src="assets/js/dashboard-v2.min.js"></script>
		<script src="assets/js/ui-modal-notification.demo.min.js"></script>
            <script src="assets/plugins/parsley/dist/parsley.js"></script>

		<script src="assets/js/apps.min.js"></script>
		<!-- ================== END PAGE LEVEL JS ================== -->

		<script>
			$(document).ready(function() {
				App.init();
				$(".datepicker").datepicker({});


    			$('select').each(
                    function(index){  
                        var input = $(this);
                        var api=input.attr('api');
                        /*alert('Api: ' + input.attr('api'));*/
                        $.ajax({
                            type: "GET",
                            url: api,
                            timeout: 6000,
                            contentType: 'application/json',
                            success: function(data)
                            {
                                helpers.buildDropdown(
                                JSON.parse(JSON.stringify(data)),
                                	input,
                                    'Select an option'
                                    );
                            }
                        });
                });

//				$('select').on('change', function() {
//					// alert('onchange'+this.value+this.name);
//					if(this.name == 'prod_brid'){
//						if ( this.value == '119'){ // value taken from masterdata
//				        	$("#divproductbrand").show();
//				      	}else{
//				        	$("#divproductbrand").hide();
//				      	}
//					}else if(this.name == 'product'){
//						if ( this.value == '120'){ // value taken from masterdata
//				        	$("#divproductcatip").show();
//				      	}else{
//				        	$("#divproductcatip").hide();
//				      	}
//					}
//			    });				


                        $('select').on('change', function() {
                            // alert('onchange'+this.value+this.name);
                            if (this.name == 'prod_brid') {
                                if (this.value == '119') { // value taken from masterdata
                                    $("#divproductbrand").show();
				$("#divproductbrand input").prop('required',true);	
                                } else {
                                    $("#divproductbrand").hide();
				$("#divproductbrand input").prop('required',false);	

                                }
                            } else if (this.name == 'product') {
                                if (this.value == '120') { // value taken from masterdata
                                    $("#divproductcatip").show();
                               	$("#divproductcatip input").prop('required',true);	
				 } else {
                                    $("#divproductcatip").hide();
				$("#divproductcatip input").prop('required',false);	

                                }
                            }
                        });
//                    });

                
			});
			
			function onSubmit(){
				alert('called');
  				if($("#image")[0].files.length > 5) {
           			alert("You can select only 5 files");
           			  $("#image").val("");
         		} else {
         			var form = $('#frmUploader');
                    form.parsley().validate();
                    if (form.parsley().isValid()) {
         				sendmulti();
         			}
                }				
			}
        </script>

        <script>

        	$('#modal-dialog').on('hidden.bs.modal', function () {
  	        	
        		$(this).find("input,textarea,select").val('').end();
                    $('#frmUploader').parsley().destroy();
                    $('#frmUploader').validate().resetForm();
 			})

        function sendmulti(){
			var form = new FormData($("#frmUploader")[0]);
			$.ajax({
			        url: "/save_request",
			        method: "POST",
			        data: form,
			        processData: false,
			        contentType: false,
			        success: function(result){
			        	var response = JSON.parse(JSON.stringify(result));
			        	// alert(response.insertId);
			        	$('#modal-dialog').modal('hide');
			        	alert("Ticket ID generated\n"+response.insertId);
			        	window.location.reload();
			        },
			        error: function(er){
			        	alert("Please enter valid details");
			        }
			});
        }
        </script>
    </body>
    </html>
